# 互联网协议

## 五层协议

- 应用层 (Application Layer)
- 传输层 (Transport Layer)
- 网络层 (Network Layer)
- 链接层 (Link Layer)
- 实体层 (Physical Layer)

越下层，越靠近硬件，越上层，越靠近用户。

## 实体层

是连接电脑的物理设备，作用是负责传输0和1的电信号。如光缆、电缆、无线电波等。

## 链接层

### 以太网协议
规定0和1分组方式。如以太网协议规定，一组电信号构成一个数据包，叫做帧。每一帧分为标头(Head)和数据(Data)。

标头的长度是18个字节，数据的长度最短46字节，最长是1500字节，整个帧的长度是64到1518字节之间。如果数据太长，则会分割为多个帧进行发送。

### MAC地址

数据从哪发到哪？以太网规定，连入网络的所有设备，都必须有网卡接口，数据包从一个网卡到另一个网卡，网卡的地址，就是数据包的发送地址和接收地址，叫MAC地址。每个网卡出厂时就有唯一的MAC地址，长度是48个二进制，通常用12个十六进制表示，如`00-B0-D0-86-BB-F7`，前六个是16进制厂商编号，后6个是该厂商的网卡流水号。

### 广播

以太网采用了一种很"原始"的方式，它不是把数据包准确送到接收方，而是向本网络内所有计算机发送，让每台计算机自己判断，是否为接收方。

## 网络层

以太网协议，依靠MAC地址发送数据。理论上，单单依靠MAC地址，上海的网卡就可以找到洛杉矶的网卡了，技术上是可以实现的。

但是，这样做有一个重大的缺点。以太网采用广播方式发送数据包，所有成员人手一"包"，不仅效率低，而且局限在发送者所在的子网络。也就是说，如果两台计算机不在同一个子网络，广播是传不过去的。这种设计是合理的，否则互联网上每一台计算机都会收到所有包，那会引起灾难。

互联网是无数子网络共同组成的一个巨型网络，很像想象上海和洛杉矶的电脑会在同一个子网络，这几乎是不可能的。

因此，必须找到一种方法，能够区分哪些MAC地址属于同一个子网络，哪些不是。如果是同一个子网络，就采用广播方式发送，否则就采用"路由"方式发送。遗憾的是，MAC地址本身无法做到这一点。它只与厂商有关，与所处网络无关。

这就导致了"网络层"的诞生。它的作用是引进一套新的地址，使得我们能够区分不同的计算机是否属于同一个子网络。这套地址就叫做"网络地址"，简称"网址"。

于是，"网络层"出现以后，每台计算机有了两种地址，一种是MAC地址，另一种是网络地址。两种地址之间没有任何联系，MAC地址是绑定在网卡上的，网络地址则是管理员分配的，它们只是随机组合在一起。

网络地址帮助我们确定计算机所在的子网络，MAC地址则将数据包送到该子网络中的目标网卡。因此，从逻辑上可以推断，必定是先处理网络地址，然后再处理MAC地址。

### IP协议

规定网络地址的协议，叫做IP协议。它所定义的地址，就被称为IP地址。

目前，广泛采用的是IP协议第四版，简称IPv4。这个版本规定，网络地址由32个二进制位组成。

## 参考资料

- [互联网协议入门（一）](http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html)
- [互联网协议入门（二）](http://www.ruanyifeng.com/blog/2012/06/internet_protocol_suite_part_ii.html)
