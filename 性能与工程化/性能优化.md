# 性能优化

**目录**

- [为什么要优化性能?](为什么要优化性能)
- [从哪些方面进行性能优化?](从哪些方面进行性能优化)
- [怎么进行性能优化?](性能优化方案)
- [性能衡量指标](性能衡量指标)

## 为什么要优化性能

性能对于网站是十分重要的，比如谷歌搜索如果慢400ms，将会损失0.5%的用户，这意味着将失去很多的收益。所以提高性能，意味着提高用户体验和网站收益。

`window.performance` 可以用来获取页面的一些性能数据。比如页面打开的时间，dns的时间，白屏的时间等等。通过这些数据，我们可以找到网站打开慢的原因，从而更好的提高网站性能。

## performance对象

### performance.memory

`performance.memory` 可以获取浏览器的内存情况，这个属性是非标准的，只有chrome浏览器有。它有三个属性分别是：

- `usedJSHeapSize` 表示所有被使用的js堆栈内存
- `totalJSHeapSize` 表示当前js堆栈内存总大小
- `jsHeapSizeLimit` 表示内存大小限制

`usedJSHeapSize`不能大于`totalJSHeapSize`，如果大于则可能出现内存泄露的情况。

## 从哪些方面进行性能优化

要知道从哪些方面来进行性能优化，首先需要知道输入网址回车的时候，浏览器做了些什么。

1. 浏览器首先通过域名查询网址的ip地址
2. 信号通过网卡到达服务器
3. 服务器

- 减小数据大小：资源压缩后，数据变小，服务器读取、传输它的时间缩短，浏览器读取解析它的时间也缩短了。

## 具体性能优化



## 性能衡量指标

## 白屏时间
cs和bs的区别：
cs是把资源打包后，安装到机器上然后解压部署到机器上。
bs是要去cdn或服务器下载资源然后显示。
cdn域名不要和主站一样，因为静态资源不需要cookie，如果一样，请求时会带cookie，增加了请求数据。

打开浏览器，输入网址发生了什么。

## 资源的合并和压缩
为什么要压缩：减少流量，加快下载
为什么合并：减少http请求，减少请求时间。减少丢包概率，
不合并的缺点：
合并的缺点：首屏渲染问题（要请求完才渲染），缓存失效问题，一个文件改变，打包文件md5就会变化，缓存就失效了。
合并的方案：库合并，页面业务逻辑合并
压缩:删除空白字符、注释和没有用到的代码，css语义合并。代码保护
开启gzip
## 图片相关优化

图片压缩的原理
有损压缩
无损压缩


png8 - 256色，支持透明。纯色时使用
png24  2^24(16777216)色，不支持透明
png32  2^24色，支持透明

图片区别和常用业务场景
jpg 有损压缩，压缩率搞，不支持透明
png支持透明，兼容好
webp 压缩程度更高，在ios webview有兼容性问题。通常在安卓使用。
svg 矢量图，代码内嵌，相对较小，图片样式相对简单的场景

css雪碧图：优点减少http请求。缺点是如果图片比较大没有加载或加载错误，所有图片都没有出来。

image inline 把小图片的内容内嵌到html中，通过base64，减少http请求，缺点是文件会增大一点。小于8kb的时候用。

使用矢量图：使用svg绘制，使用iconfont解决icon问题。

webp 优势体现在具有更优的图像数据压缩算法，能带来更小的图片体积，而且拥有肉眼识别无差异的图像质量，同时具有无损和有损压缩模式、透明度以及动画的特性。在jpeg和png上的转化效果都非常优秀、稳定和统一。

facebook pc版是将雪碧图拆分，某一块合并，而且大小也要控制

淘宝手机版是用的webp, 图片格式是 .jpg_.webp，如果不支持，就用jpg。这通过图片服务器控制返回。

tinypng 智图
spritecow.com  
## css和js的装载和执行
## 重绘和重排
## 参考资料

- [研究首屏时间？你先要知道这几点细节](http://www.alloyteam.com/2016/01/points-about-resource-loading/)
- [初探 performance – 监控网页与程序性能](http://www.alloyteam.com/2015/09/explore-performance/)
- [使用performance API 监测页面性能](http://www.alloyteam.com/2012/11/performance-api-monitoring-page-performance/)
- [网页性能监控利器---Performance](http://www.imweb.io/topic/597f3cb01e8320bb61cf3aa8)
- [天猫双11前端分享系列（一）：活动页面的性能优化](https://github.com/tmallfe/tmallfe.github.io/issues/25)
- [天猫双11前端分享系列(二)：天猫双11页面服务容灾方案大揭秘](https://github.com/tmallfe/tmallfe.github.io/issues/26)
- [Javascript高性能动画与页面渲染](http://www.infoq.com/cn/articles/javascript-high-performance-animation-and-page-rendering)
- [前端架构](http://saito.im/note/The-Architecture-of-F2E/)
- [http://www.css88.com/nav/]
- [JavaScript中的this陷阱的最全收集--没有之一](https://segmentfault.com/a/1190000002640298#articleHeader1)
- [使用 RAIL 模型评估性能](https://developers.google.com/web/fundamentals/performance/rail?hl=zh-cn)